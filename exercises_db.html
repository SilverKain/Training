<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container { max-width: 900px; margin: 0 auto; }

        header {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-left { display: flex; align-items: center; gap: 15px; }

        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }
        .back-btn:hover { transform: scale(1.05); }

        h1 { color: #667eea; font-size: 1.8em; }

        .add-btn {
            background: linear-gradient(135deg, #4caf50 0%, #43a047 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .add-btn:hover { transform: scale(1.05); }

        .reset-btn {
            background: transparent;
            color: #aaa;
            border: 1.5px solid #ddd;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.2s;
        }
        .reset-btn:hover { background: #fff0f0; color: #e53935; border-color: #e53935; }

        /* Search & Filter */
        .controls {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 16px;
            border: 2px solid #dbe4ff;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.2s;
        }
        .search-input:focus { border-color: #667eea; }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #dbe4ff;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            cursor: pointer;
            background: white;
            color: #333;
        }
        .filter-select:focus { border-color: #667eea; }

        .count-badge {
            background: #667eea;
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Exercise Cards Grid */
        .exercise-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 14px;
        }

        .exercise-card {
            background: white;
            border-radius: 14px;
            box-shadow: 0 4px 14px rgba(102,126,234,0.12);
            border: 2px solid #dbe4ff;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
        }
        .exercise-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 28px rgba(102,126,234,0.22);
            border-color: #667eea;
        }

        .card-img {
            width: 100%;
            aspect-ratio: 4/3;
            object-fit: cover;
            display: block;
            background: #f0f0f0;
        }
        .card-img-placeholder {
            width: 100%;
            aspect-ratio: 4/3;
            background: linear-gradient(135deg, #e8ecff 0%, #d0d8ff 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .card-body {
            padding: 12px 14px 8px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .card-name {
            font-size: 1em;
            font-weight: 800;
            color: #1a1a2e;
            cursor: pointer;
            line-height: 1.3;
            transition: color 0.2s;
        }
        .card-name:hover { color: #667eea; }

        .card-category {
            display: inline-block;
            background: #eef1ff;
            color: #667eea;
            font-size: 0.75em;
            padding: 2px 9px;
            border-radius: 12px;
            font-weight: 600;
            width: fit-content;
        }
        .card-category[data-cat="–†–∞–∑–º–∏–Ω–∫–∞"] { background: #fff3e0; color: #e65100; }

        .card-muscles {
            color: #667eea;
            font-size: 0.82em;
            font-weight: 600;
        }

        .card-sets-row {
            display: flex;
            align-items: baseline;
            gap: 3px;
            flex-wrap: wrap;
        }
        .card-sets-num {
            font-size: 1.6em;
            font-weight: 900;
            color: #667eea;
            line-height: 1;
        }
        .card-sets-label {
            font-size: 0.85em;
            font-weight: 600;
            color: #667eea;
        }
        .card-sets-x {
            font-size: 0.9em;
            font-weight: 700;
            color: #9ca3af;
            margin: 0 2px;
        }
        .card-reps {
            font-size: 0.9em;
            font-weight: 700;
            color: #374151;
        }

        .card-technique {
            color: #555;
            font-size: 0.83em;
            line-height: 1.5;
            padding: 8px 10px;
            background: #f8f9ff;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            margin-top: 4px;
            display: none;
        }
        .card-technique.open { display: block; }

        .card-levels {
            margin-top: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            border-top: 1px dashed #c7d0ff;
            padding-top: 7px;
        }
        .card-levels-title {
            font-size: 0.78em;
            font-weight: 700;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            margin-bottom: 2px;
        }
        .level-badge {
            display: flex;
            gap: 6px;
            font-size: 0.82em;
            line-height: 1.4;
            align-items: flex-start;
        }
        .level-icon { flex-shrink: 0; }
        .level-label { font-weight: 700; margin-right: 3px; }
        .level-easy .level-label { color: #2e7d32; }
        .level-medium .level-label { color: #e65100; }
        .level-hard .level-label { color: #c62828; }
        .level-text { color: #444; }

        .card-actions {
            display: flex;
            gap: 6px;
            padding: 6px 14px 10px;
            border-top: 1px solid #f0f0f0;
            justify-content: flex-end;
        }

        .edit-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.82em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .edit-btn:hover { transform: scale(1.05); }

        .delete-btn {
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            color: white;
            border: none;
            padding: 7px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.82em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .delete-btn:hover { transform: scale(1.05); }

        .empty-state {
            background: white;
            border-radius: 12px;
            padding: 50px 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            color: #888;
        }
        .empty-state p { font-size: 1.1em; margin-top: 10px; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.hidden { display: none; }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            font-size: 1.4em;
            color: #667eea;
        }

        .modal-close {
            background: #f44336;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #dbe4ff;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
            color: #333;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus { border-color: #667eea; }

        .form-group textarea { min-height: 80px; resize: vertical; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .save-btn:hover { transform: scale(1.05); }

        .cancel-btn {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        .cancel-btn:hover { background: #ccc; }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4caf50;
            color: white;
            padding: 14px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 9999;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.error { background: #f44336; }

        @media (max-width: 700px) {
            header { padding: 15px; }
            h1 { font-size: 1.3em; }
            .form-row { grid-template-columns: 1fr; }
            .modal-content { padding: 20px; }
            .exercise-cards { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .card-sets-num { font-size: 1.3em; }
        }

        @media (max-width: 420px) {
            .exercise-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="header-left">
            <a href="index.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥</a>
            <h1>üèãÔ∏è –ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h1>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <button class="reset-btn" onclick="resetDB()" title="–°–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é –±–∞–∑—É">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É</button>
            <button class="add-btn" onclick="openAddModal()">+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
        </div>
    </header>

    <div class="controls">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –º—ã—à—Ü–∞–º..." oninput="renderExercises()">
        <select class="filter-select" id="categoryFilter" onchange="renderExercises()">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        </select>
        <span class="count-badge" id="countBadge">0 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
    </div>

    <div class="exercise-cards" id="exerciseCards"></div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay hidden" id="exerciseModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h3>
            <button class="modal-close" onclick="closeModal()">‚úï</button>
        </div>

        <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" id="fName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <input type="text" id="fCategory" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—Ä—É–¥—å / –¢—Ä–∏—Ü–µ–ø—Å—ã">
            </div>
            <div class="form-group">
                <label>–ì—Ä—É–ø–ø—ã –º—ã—à—Ü *</label>
                <input type="text" id="fMuscles" placeholder="–ì—Ä—É–¥—å, —Ç—Ä–∏—Ü–µ–ø—Å—ã...">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–ü–æ–¥—Ö–æ–¥–æ–≤ (–ø–æ —É–º–æ–ª—á.)</label>
                <input type="number" id="fSets" min="1" max="20" value="3">
            </div>
            <div class="form-group">
                <label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π / –≤—Ä–µ–º—è</label>
                <input type="text" id="fReps" placeholder="10-12 –∏–ª–∏ 30 —Å–µ–∫">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–û—Ç–¥—ã—Ö (—Å–µ–∫)</label>
                <input type="number" id="fRest" min="10" max="300" value="60">
            </div>
            <div class="form-group">
                <label>–¢–µ–º–ø</label>
                <input type="text" id="fTempo" placeholder="—Å—Ä–µ–¥–Ω–∏–π / —Å—Ç–∞—Ç–∏–∫–∞...">
            </div>
        </div>

        <div class="form-group">
            <label>–¢–µ—Ö–Ω–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
            <textarea id="fTechnique" placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É..."></textarea>
        </div>

        <div class="modal-actions">
            <button class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="save-btn" onclick="saveExercise()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
const DB_KEY = 'exercisesDB';
const DB_VER_KEY = 'exercisesDB_ver';
const DB_VER = 2;          // —É–≤–µ–ª–∏—á–∏—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
const SEED_URL = 'exercises_db.json';
let editingId = null;

// ===== DB Helpers =====
function getDB() {
    const raw = localStorage.getItem(DB_KEY);
    return raw ? JSON.parse(raw) : null;
}

function saveDB(db) {
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    localStorage.setItem(DB_VER_KEY, String(DB_VER));
}

function getSavedVer() {
    return parseInt(localStorage.getItem(DB_VER_KEY) || '0');
}

function upgradeDB() {
    const warmup = [
        { id:16, name:"–í—Ä–∞—â–µ–Ω–∏–µ –ø–ª–µ—á–∞–º–∏", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ü–ª–µ—á–µ–≤–æ–π –ø–æ—è—Å, —Ç—Ä–∞–ø–µ—Ü–∏–∏", defaultSets:2, defaultReps:"10 –≤–ø–µ—Ä—ë–¥ + 10 –Ω–∞–∑–∞–¥", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è –ø—Ä—è–º–æ, –ø–æ–¥–Ω–∏–º–∞—Ç—å –æ–±–∞ –ø–ª–µ—á–∞ –≤–≤–µ—Ä—Ö, –æ—Ç–≤–æ–¥–∏—Ç—å –Ω–∞–∑–∞–¥ –∏ –æ–ø—É—Å–∫–∞—Ç—å –ø–æ –∫—Ä—É–≥—É. 10 —Ä–∞–∑ –≤–ø–µ—Ä—ë–¥, 10 —Ä–∞–∑ –Ω–∞–∑–∞–¥." },
        { id:17, name:"–ö—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —à–µ–µ–π", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ú—ã—à—Ü—ã —à–µ–∏, —Ç—Ä–∞–ø–µ—Ü–∏–∏", defaultSets:2, defaultReps:"5 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–ú–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞–∫–ª–æ–Ω—è—Ç—å –≥–æ–ª–æ–≤—É –≤–ø—Ä–∞–≤–æ ‚Äî –∫ –≥—Ä—É–¥–∏ ‚Äî –≤–ª–µ–≤–æ ‚Äî –Ω–∞–∑–∞–¥. –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞–≤–Ω–æ–µ, –±–µ–∑ —Ä—ã–≤–∫–æ–≤." },
        { id:18, name:"–ù–∞–∫–ª–æ–Ω—ã –∫–æ—Ä–ø—É—Å–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—ã", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ö–æ—Å—ã–µ –º—ã—à—Ü—ã –ø—Ä–µ—Å—Å–∞, —à–∏—Ä–æ—á–∞–π—à–∏–µ, –±–æ–∫–∞", defaultSets:2, defaultReps:"10 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è, –Ω–æ–≥–∏ –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á. –ù–∞–∫–ª–æ–Ω—è—Ç—å—Å—è –≤ —Å—Ç–æ—Ä–æ–Ω—É, —Ç—è–Ω—è—Å—å —Ä—É–∫–æ–π –≤–Ω–∏–∑. –£–¥–µ—Ä–∂–∞—Ç—å 1‚Äì2 —Å–µ–∫, –≤–µ—Ä–Ω—É—Ç—å—Å—è." },
        { id:19, name:"–ö—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–∞–∑–æ–º", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–¢–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–π —Å—É—Å—Ç–∞–≤, –ø–æ—è—Å–Ω–∏—Ü–∞", defaultSets:2, defaultReps:"10 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è, —Ä—É–∫–∏ –Ω–∞ –±—ë–¥—Ä–∞—Ö. –í—Ä–∞—â–∞—Ç–µ–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–∞–∑–æ–º –ø–æ –∫—Ä—É–≥—É. 10 —Ä–∞–∑ –ø–æ —á–∞—Å–æ–≤–æ–π, 10 —Ä–∞–∑ –ø—Ä–æ—Ç–∏–≤." },
        { id:20, name:"–•–æ–¥—å–±–∞ —Å –ø–æ–¥—ä—ë–º–æ–º –∫–æ–ª–µ–Ω", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–°–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞, –∏–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ, –ø—Ä–µ—Å—Å", defaultSets:2, defaultReps:"20 —à–∞–≥–æ–≤", defaultRest:30, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–•–æ–¥–∏—Ç—å –Ω–∞ –º–µ—Å—Ç–µ, –≤—ã—Å–æ–∫–æ –ø–æ–¥–Ω–∏–º–∞—è –∫–æ–ª–µ–Ω–∏ –¥–æ —É—Ä–æ–≤–Ω—è –ø–æ—è—Å–∞. –†—É–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –≤ —Ç–∞–∫—Ç. –°–ø–∏–Ω–∞ –ø—Ä—è–º–∞—è." },
        { id:21, name:"–ü—Ä—ã–∂–∫–∏ ¬´–ó–≤–µ–∑–¥–∞¬ª", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–í—Å—ë —Ç–µ–ª–æ, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞", defaultSets:2, defaultReps:"20", defaultRest:30, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–ò–∑ –ò–ü –ø—Ä—ã–≥–Ω—É—Ç—å, —Ä–∞–∑–≤–æ–¥—è –Ω–æ–≥–∏ –∏ –ø–æ–¥–Ω–∏–º–∞—è —Ä—É–∫–∏ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π. –ü—Ä–∏–∑–µ–º–ª–∏—Ç—å—Å—è –º—è–≥–∫–æ. –í–µ—Ä–Ω—É—Ç—å—Å—è –ø—Ä—ã–∂–∫–æ–º." },
        { id:22, name:"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, —Å–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞", defaultSets:2, defaultReps:"8 –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–≥—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–®–∞–≥–Ω—É—Ç—å –≤–ø–µ—Ä—ë–¥, –æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–Ω–µ–µ –∫–æ–ª–µ–Ω–æ. –£–¥–µ—Ä–∂–∞—Ç—å 1‚Äì2 —Å–µ–∫, –ø–æ–¥–Ω—è—Ç—å—Å—è. –ß–µ—Ä–µ–¥–æ–≤–∞—Ç—å –Ω–æ–≥–∏." }
    ];
    const db = getDB() || [];
    const existingIds = new Set(db.map(e => e.id));
    let added = false;
    warmup.forEach(ex => {
        if (!existingIds.has(ex.id) && !db.find(e => e.name === ex.name)) {
            db.push(ex);
            added = true;
        }
    });
    if (added) saveDB(db);
}

async function resetDB() {
    localStorage.removeItem(DB_KEY);
    localStorage.removeItem(DB_VER_KEY);
    showToast('–ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –±–∞–∑—ã...');
    await initDB();
    showToast('–ë–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ' + (getDB() || []).length + ' —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π ‚úì');
}

async function initDB() {
    const existing = getDB();
    const savedVer = getSavedVer();

    // –í—Å–µ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–¥—Ç—è–Ω—É—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON
    // (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–µ—Ä—Å–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –ò –¥–∞–Ω–Ω—ã–µ —É–∂–µ –ø–æ–ª–Ω—ã–µ)
    const isUpToDate = savedVer >= DB_VER && existing !== null && existing.length >= 53;
    if (!isUpToDate) {
        try {
            const res = await fetch(SEED_URL + '?v=' + DB_VER);
            if (res.ok) {
                const data = await res.json();
                saveDB(data.exercises || []);
                renderExercises();
                return;
            }
        } catch (e) { /* fallthrough */ }
    }
    // localStorage –∞–∫—Ç—É–∞–ª–µ–Ω ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if (existing !== null && existing.length > 0) {
        renderExercises();
        return;
    }
    // –ê–≤–∞—Ä–∏–π–Ω—ã–π —Ñ–æ–ª–±—ç–∫ –¥–ª—è file:// ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–µ—Ä–≤—ã–µ 22 –±–µ–∑ levels)
    const seed = [
        { id:1, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞", category:"–ì—Ä—É–¥—å / –¢—Ä–∏—Ü–µ–ø—Å—ã", muscles:"–ì—Ä—É–¥—å, —Ç—Ä–∏—Ü–µ–ø—Å—ã, –ø–µ—Ä–µ–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã", defaultSets:3, defaultReps:"8-10", defaultRest:90, defaultTempo:"2 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–ò–ü: —É–ø–æ—Ä –ª—ë–∂–∞, —Ä—É–∫–∏ —à–∏—Ä–µ –ø–ª–µ—á. –û–ø—É—Å–∫–∞—Ç—å—Å—è –¥–æ –∫–∞—Å–∞–Ω–∏—è –≥—Ä—É–¥–∏ –ø–æ–ª–∞." },
        { id:2, name:"–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"2 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–°—Ç–æ–ø—ã –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á, –Ω–æ—Å–∫–∏ —Å–ª–µ–≥–∫–∞ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã." },
        { id:3, name:"–ü–ª–∞–Ω–∫–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ö–æ—Ä, –ø—Ä–µ—Å—Å, —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä—ã –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞", defaultSets:3, defaultReps:"20-30 —Å–µ–∫", defaultRest:60, defaultTempo:"—Å—Ç–∞—Ç–∏–∫–∞", technique:"–£–ø–æ—Ä –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è –∏ –Ω–æ—Å–∫–∏, —Ç–µ–ª–æ –≤ –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏." },
        { id:4, name:"–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç", category:"–Ø–≥–æ–¥–∏—Ü—ã", muscles:"–Ø–≥–æ–¥–∏—Ü—ã, –∑–∞–¥–Ω—è—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"2 –≤–≤–µ—Ä—Ö, 1 –ø–∞—É–∑–∞, 2 –≤–Ω–∏–∑", technique:"–õ—ë–∂–∞ –Ω–∞ —Å–ø–∏–Ω–µ, –Ω–æ–≥–∏ —Å–æ–≥–Ω—É—Ç—ã. –ü–æ–¥–Ω–∏–º–∞—Ç—å —Ç–∞–∑, —Å–∂–∏–º–∞—è —è–≥–æ–¥–∏—Ü—ã." },
        { id:5, name:"–û–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç—É–ª–∞", category:"–¢—Ä–∏—Ü–µ–ø—Å—ã", muscles:"–¢—Ä–∏—Ü–µ–ø—Å—ã, –∑–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã", defaultSets:3, defaultReps:"8-10", defaultRest:80, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–°–∏–¥—è –Ω–∞ –∫—Ä–∞—é —Å—Ç—É–ª–∞, —Ä—É–∫–∏ –Ω–∞ —Å–∏–¥–µ–Ω–∏–∏." },
        { id:6, name:"–í—ã–ø–∞–¥—ã –Ω–∞ –º–µ—Å—Ç–µ", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –∏–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ", defaultSets:3, defaultReps:"10 –Ω–∞ –Ω–æ–≥—É", defaultRest:60, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–û–¥–Ω–∞ –Ω–æ–≥–∞ –≤–ø–µ—Ä–µ–¥–∏. –û–ø—É—Å–∫–∞—Ç—å—Å—è, —Å–≥–∏–±–∞—è –æ–±–∞ –∫–æ–ª–µ–Ω–∞ –¥–æ 90¬∞." },
        { id:7, name:"–ë–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ö–æ—Å—ã–µ –º—ã—à—Ü—ã –ø—Ä–µ—Å—Å–∞, –∫–æ—Ä", defaultSets:3, defaultReps:"20-30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω—É", defaultRest:60, defaultTempo:"—Å—Ç–∞—Ç–∏–∫–∞", technique:"–õ—ë–∂–∞ –Ω–∞ –±–æ–∫—É, —É–ø–æ—Ä –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å–µ." },
        { id:8, name:"–°—É–ø–µ—Ä–º–µ–Ω", category:"–°–ø–∏–Ω–∞ / –Ø–≥–æ–¥–∏—Ü—ã", muscles:"–ú—ã—à—Ü—ã —Å–ø–∏–Ω—ã, —è–≥–æ–¥–∏—Ü—ã", defaultSets:3, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–õ—ë–∂–∞ –Ω–∞ –∂–∏–≤–æ—Ç–µ, —Ä—É–∫–∏ –≤–ø–µ—Ä—ë–¥. –ü–æ–¥–Ω–∏–º–∞—Ç—å –≥—Ä—É–¥—å –∏ –Ω–æ–≥–∏." },
        { id:9, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è —É–∑–∫–∏–º —Ö–≤–∞—Ç–æ–º", category:"–¢—Ä–∏—Ü–µ–ø—Å—ã / –ì—Ä—É–¥—å", muscles:"–¢—Ä–∏—Ü–µ–ø—Å—ã, –≥—Ä—É–¥—å (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å)", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"3 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–õ–∞–¥–æ–Ω–∏ —á—É—Ç—å —É–∂–µ –ø–ª–µ—á, –ª–æ–∫—Ç–∏ –±–ª–∏–∂–µ –∫ –∫–æ—Ä–ø—É—Å—É." },
        { id:10, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è —Å —à–∏—Ä–æ–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π", category:"–ì—Ä—É–¥—å", muscles:"–ì—Ä—É–¥—å (–≤–Ω–µ—à–Ω—è—è —á–∞—Å—Ç—å), –ø–µ—Ä–µ–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã, —Ç—Ä–∏—Ü–µ–ø—Å—ã", defaultSets:4, defaultReps:"12-15", defaultRest:60, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–£–ø–æ—Ä –ª—ë–∂–∞, —Ä—É–∫–∏ —à–∏—Ä–æ–∫–æ —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã." },
        { id:11, name:"–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ", category:"–Ø–≥–æ–¥–∏—Ü—ã", muscles:"–Ø–≥–æ–¥–∏—Ü—ã, –∑–∞–¥–Ω—è—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"8-10 –Ω–∞ –Ω–æ–≥—É", defaultRest:90, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–û–¥–Ω–∞ —Å—Ç–æ–ø–∞ –Ω–∞ –ø–æ–ª—É, –≤—Ç–æ—Ä–∞—è –Ω–æ–≥–∞ –Ω–∞ –≤–µ—Å—É." },
        { id:12, name:"–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –ø–∞—É–∑–æ–π", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞", defaultSets:4, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å –ø–∞—É–∑–æ–π", technique:"–ó–∞–¥–µ—Ä–∂–∞—Ç—å—Å—è –≤ –Ω–∏–∂–Ω–µ–π —Ç–æ—á–∫–µ 3 —Å–µ–∫." },
        { id:13, name:"–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–µ—Å—Å", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ü—Ä—è–º–∞—è –º—ã—à—Ü–∞ –∂–∏–≤–æ—Ç–∞, –ø—Ä–µ—Å—Å", defaultSets:3, defaultReps:"15-20", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–õ—ë–∂–∞ –Ω–∞ —Å–ø–∏–Ω–µ, –ø–æ–¥–Ω–∏–º–∞—Ç—å –ø–ª–µ—á–∏ –æ—Ç –ø–æ–ª–∞." },
        { id:14, name:"–ë–µ—Ä–ø–∏", category:"–ö–∞—Ä–¥–∏–æ / –í—Å—ë —Ç–µ–ª–æ", muscles:"–í—Å—ë —Ç–µ–ª–æ, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞", defaultSets:3, defaultReps:"10", defaultRest:90, defaultTempo:"–±—ã—Å—Ç—Ä—ã–π", technique:"–ü—Ä—ã–∂–æ–∫ –≤ —É–ø–æ—Ä –ª—ë–∂–∞, –æ—Ç–∂–∏–º–∞–Ω–∏–µ, –ø—Ä—ã–∂–æ–∫ –≤–≤–µ—Ä—Ö." },
        { id:15, name:"–ü–æ–¥—ä—ë–º –Ω–æ–≥ –ª—ë–∂–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ù–∏–∂–Ω–∏–π –ø—Ä–µ—Å—Å, —Å–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–ü–æ–¥–Ω–∏–º–∞—Ç—å –ø—Ä—è–º—ã–µ –Ω–æ–≥–∏ –¥–æ 90¬∞, –º–µ–¥–ª–µ–Ω–Ω–æ –æ–ø—É—Å–∫–∞—Ç—å." },
        { id:16, name:"–í—Ä–∞—â–µ–Ω–∏–µ –ø–ª–µ—á–∞–º–∏", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ü–ª–µ—á–µ–≤–æ–π –ø–æ—è—Å, —Ç—Ä–∞–ø–µ—Ü–∏–∏", defaultSets:2, defaultReps:"10 –≤–ø–µ—Ä—ë–¥ + 10 –Ω–∞–∑–∞–¥", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è –ø—Ä—è–º–æ, –ø–æ–¥–Ω–∏–º–∞—Ç—å –æ–±–∞ –ø–ª–µ—á–∞ –≤–≤–µ—Ä—Ö, –æ—Ç–≤–æ–¥–∏—Ç—å –Ω–∞–∑–∞–¥ –∏ –æ–ø—É—Å–∫–∞—Ç—å –ø–æ –∫—Ä—É–≥—É. 10 —Ä–∞–∑ –≤–ø–µ—Ä—ë–¥, 10 —Ä–∞–∑ –Ω–∞–∑–∞–¥." },
        { id:17, name:"–ö—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —à–µ–µ–π", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ú—ã—à—Ü—ã —à–µ–∏, —Ç—Ä–∞–ø–µ—Ü–∏–∏", defaultSets:2, defaultReps:"5 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–ú–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞–∫–ª–æ–Ω—è—Ç—å –≥–æ–ª–æ–≤—É –≤–ø—Ä–∞–≤–æ ‚Äî –∫ –≥—Ä—É–¥–∏ ‚Äî –≤–ª–µ–≤–æ ‚Äî –Ω–∞–∑–∞–¥. –î–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞–≤–Ω–æ–µ, –±–µ–∑ —Ä—ã–≤–∫–æ–≤." },
        { id:18, name:"–ù–∞–∫–ª–æ–Ω—ã –∫–æ—Ä–ø—É—Å–∞ –≤ —Å—Ç–æ—Ä–æ–Ω—ã", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ö–æ—Å—ã–µ –º—ã—à—Ü—ã –ø—Ä–µ—Å—Å–∞, —à–∏—Ä–æ—á–∞–π—à–∏–µ, –±–æ–∫–∞", defaultSets:2, defaultReps:"10 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è, –Ω–æ–≥–∏ –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á. –ù–∞–∫–ª–æ–Ω—è—Ç—å—Å—è –≤ —Å—Ç–æ—Ä–æ–Ω—É, —Ç—è–Ω—è—Å—å —Ä—É–∫–æ–π –≤–Ω–∏–∑. –£–¥–µ—Ä–∂–∞—Ç—å 1‚Äì2 —Å–µ–∫, –≤–µ—Ä–Ω—É—Ç—å—Å—è." },
        { id:19, name:"–ö—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–∞–∑–æ–º", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–¢–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–π —Å—É—Å—Ç–∞–≤, –ø–æ—è—Å–Ω–∏—Ü–∞", defaultSets:2, defaultReps:"10 –≤ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–°—Ç–æ—è, —Ä—É–∫–∏ –Ω–∞ –±—ë–¥—Ä–∞—Ö. –í—Ä–∞—â–∞—Ç–µ–ª—å–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ç–∞–∑–æ–º –ø–æ –∫—Ä—É–≥—É. 10 —Ä–∞–∑ –ø–æ —á–∞—Å–æ–≤–æ–π, 10 —Ä–∞–∑ –ø—Ä–æ—Ç–∏–≤." },
        { id:20, name:"–•–æ–¥—å–±–∞ —Å –ø–æ–¥—ä—ë–º–æ–º –∫–æ–ª–µ–Ω", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–°–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞, –∏–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ, –ø—Ä–µ—Å—Å", defaultSets:2, defaultReps:"20 —à–∞–≥–æ–≤", defaultRest:30, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–•–æ–¥–∏—Ç—å –Ω–∞ –º–µ—Å—Ç–µ, –≤—ã—Å–æ–∫–æ –ø–æ–¥–Ω–∏–º–∞—è –∫–æ–ª–µ–Ω–∏ –¥–æ —É—Ä–æ–≤–Ω—è –ø–æ—è—Å–∞. –†—É–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –≤ —Ç–∞–∫—Ç. –°–ø–∏–Ω–∞ –ø—Ä—è–º–∞—è." },
        { id:21, name:"–ü—Ä—ã–∂–∫–∏ ¬´–ó–≤–µ–∑–¥–∞¬ª", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–í—Å—ë —Ç–µ–ª–æ, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞", defaultSets:2, defaultReps:"20", defaultRest:30, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–ò–∑ –ò–ü –ø—Ä—ã–≥–Ω—É—Ç—å, —Ä–∞–∑–≤–æ–¥—è –Ω–æ–≥–∏ –∏ –ø–æ–¥–Ω–∏–º–∞—è —Ä—É–∫–∏ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π. –ü—Ä–∏–∑–µ–º–ª–∏—Ç—å—Å—è –º—è–≥–∫–æ. –í–µ—Ä–Ω—É—Ç—å—Å—è –ø—Ä—ã–∂–∫–æ–º." },
        { id:22, name:"–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã", category:"–†–∞–∑–º–∏–Ω–∫–∞", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, —Å–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞", defaultSets:2, defaultReps:"8 –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–≥—É", defaultRest:30, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–®–∞–≥–Ω—É—Ç—å –≤–ø–µ—Ä—ë–¥, –æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–Ω–µ–µ –∫–æ–ª–µ–Ω–æ. –£–¥–µ—Ä–∂–∞—Ç—å 1‚Äì2 —Å–µ–∫, –ø–æ–¥–Ω—è—Ç—å—Å—è. –ß–µ—Ä–µ–¥–æ–≤–∞—Ç—å –Ω–æ–≥–∏." }
    ];
    saveDB(seed);
    renderExercises();
}

function getCategories(db) {
    const cats = [...new Set(db.map(e => e.category).filter(Boolean))].sort();
    return cats;
}

// ===== Image Map =====
const exerciseImages = {
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è —É–∑–∫–∏–º —Ö–≤–∞—Ç–æ–º": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_2.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è —Å —à–∏—Ä–æ–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_2.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –≤–æ–∑–≤—ã—à–µ–Ω–Ω–æ—Å—Ç–∏": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png",
    "–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –ø–∞—É–∑–æ–π": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png",
    "–ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –ø–∞—É–∑–æ–π (3 —Å–µ–∫)": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png",
    "–ø–ª–∞–Ω–∫–∞": "Pic/–ü–ª–∞–Ω–∫–∞.png",
    "–±–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞": "Pic/–ë–æ–∫–æ–≤–∞—è_–ø–ª–∞–Ω–∫–∞.png",
    "—è–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç": "Pic/–Ø–≥–æ–¥–∏—á–Ω—ã–π_–º–æ—Å—Ç.png",
    "—è–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ": "Pic/–Ø–≥–æ–¥–∏—á–Ω—ã–π_–º–æ—Å—Ç.png",
    "–ø–æ–¥—ä—ë–º—ã —Ç–∞–∑–∞ –ª—ë–∂–∞ (—è–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç)": "Pic/–Ø–≥–æ–¥–∏—á–Ω—ã–π_–º–æ—Å—Ç.png",
    "–æ–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è": "Pic/–û–±—Ä–∞—Ç–Ω—ã–µ_–æ—Ç–∂–∏–º–∞–Ω–∏—è_–æ—Ç_—Å—Ç—É–ª–∞.png",
    "–æ–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç—É–ª–∞": "Pic/–û–±—Ä–∞—Ç–Ω—ã–µ_–æ—Ç–∂–∏–º–∞–Ω–∏—è_–æ—Ç_—Å—Ç—É–ª–∞.png",
    "–≤—ã–ø–∞–¥—ã": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–≤—ã–ø–∞–¥—ã –Ω–∞ –º–µ—Å—Ç–µ": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–≤—ã–ø–∞–¥—ã –Ω–∞–∑–∞–¥": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–±–æ–ª–≥–∞—Ä—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–ø—Ä—ã–∂–∫–∏ –∏–∑ –≤—ã–ø–∞–¥–∞": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã–ø–∞–¥—ã": "Pic/–í—ã–ø–∞–¥—ã_–Ω–∞_–º–µ—Å—Ç–µ.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç–µ–Ω—ã": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è —Å –∫–æ–ª–µ–Ω": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è —Å –ø–∞—É–∑–æ–π –≤–Ω–∏–∑—É": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–ø–ª–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_1.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è –¥–æ–º–∏–∫–æ–º": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_2.png",
    "–ø—Å–µ–≤–¥–æ-—Å—Ç–æ–π–∫–∞ —É —Å—Ç–µ–Ω—ã": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_2.png",
    "–æ—Ç–∂–∏–º–∞–Ω–∏—è –ø–∏–∫–µ": "Pic/–û—Ç–∂–∏–º–∞–Ω–∏—è_2.png",
    "–Ω–µ–ø–æ–ª–Ω—ã–µ –ø—Ä–∏—Å–µ–¥–∞–Ω–∏—è": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png",
    "–ø–∏—Å—Ç–æ–ª–µ—Ç –∫ —Å—Ç—É–ª—É": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png",
    "–≤—ã–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è –∏–∑ –ø—Ä–∏—Å–µ–¥–∞": "Pic/–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è.png"
};

function getCardImage(name) {
    return exerciseImages[(name || '').toLowerCase()] || null;
}

// ===== Render =====
function renderExercises() {
    const db = getDB() || [];
    const search = document.getElementById('searchInput').value.toLowerCase();
    const cat = document.getElementById('categoryFilter').value;

    // Update category filter options
    const catSelect = document.getElementById('categoryFilter');
    const currentCat = catSelect.value;
    const cats = getCategories(db);
    catSelect.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>' +
        cats.map(c => `<option value="${c}" ${c === currentCat ? 'selected' : ''}>${c}</option>`).join('');

    let filtered = db;
    if (search) {
        filtered = filtered.filter(e =>
            e.name.toLowerCase().includes(search) ||
            (e.muscles || '').toLowerCase().includes(search) ||
            (e.category || '').toLowerCase().includes(search)
        );
    }
    if (cat) {
        filtered = filtered.filter(e => e.category === cat);
    }

    document.getElementById('countBadge').textContent = `${filtered.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π`;

    const container = document.getElementById('exerciseCards');
    if (filtered.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div style="font-size:3em;">üèãÔ∏è</div>
                <p>${search || cat ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫.' : '–ë–∞–∑–∞ –ø—É—Å—Ç–∞. –ù–∞–∂–º–∏—Ç–µ ¬´+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ¬ª.'}</p>
            </div>`;
        return;
    }

    container.innerHTML = filtered.map(ex => {
        const imgSrc = getCardImage(ex.name);
        const imgHtml = imgSrc
            ? `<img class="card-img" src="${imgSrc}" alt="${escHtml(ex.name)}">`
            : `<div class="card-img-placeholder">üí™</div>`;
        return `
        <div class="exercise-card">
            ${imgHtml}
            <div class="card-body">
                <div class="card-name" onclick="toggleTechnique(${ex.id})" title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è —Ç–µ—Ö–Ω–∏–∫–∏">${escHtml(ex.name)} <span style="font-size:0.75em;color:#aaa;">‚ñæ</span></div>
                ${ex.category ? `<span class="card-category" data-cat="${escHtml(ex.category)}">${escHtml(ex.category)}</span>` : ''}
                <div class="card-muscles">üéØ ${escHtml(ex.muscles || '')}</div>
                <div class="card-sets-row">
                    <span class="card-sets-num">${ex.defaultSets}</span>
                    <span class="card-sets-label">–ø–æ–¥—Ö.</span>
                    <span class="card-sets-x">√ó</span>
                    <span class="card-reps">${escHtml(ex.defaultReps || '')}</span>
                </div>
                ${(ex.technique || ex.levels) ? `<div class="card-technique" id="tech-${ex.id}">
                    ${ex.technique ? `<div>‚öôÔ∏è ${escHtml(ex.technique)}</div>` : ''}
                    ${ex.levels ? `<div class="card-levels">
                        <div class="card-levels-title">üìä –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</div>
                        <div class="level-badge level-easy"><span class="level-icon">üü¢</span><span class="level-text"><span class="level-label">–õ—ë–≥–∫–∏–π:</span>${escHtml(ex.levels.easy || '')}</span></div>
                        <div class="level-badge level-medium"><span class="level-icon">üü°</span><span class="level-text"><span class="level-label">–°—Ä–µ–¥–Ω–∏–π:</span>${escHtml(ex.levels.medium || '')}</span></div>
                        <div class="level-badge level-hard"><span class="level-icon">üî¥</span><span class="level-text"><span class="level-label">–°–ª–æ–∂–Ω—ã–π:</span>${escHtml(ex.levels.hard || '')}</span></div>
                    </div>` : ''}
                </div>` : ''}
            </div>
            <div class="card-actions">
                <button class="edit-btn" onclick="openEditModal(${ex.id})">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                <button class="delete-btn" onclick="deleteExercise(${ex.id})">üóë</button>
            </div>
        </div>
    `}).join('');
}

function escHtml(str) {
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
}

function toggleTechnique(id) {
    const el = document.getElementById('tech-' + id);
    if (el) el.classList.toggle('open');
}

// ===== Modal =====
function openAddModal() {
    editingId = null;
    document.getElementById('modalTitle').textContent = '–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ';
    document.getElementById('fName').value = '';
    document.getElementById('fCategory').value = '';
    document.getElementById('fMuscles').value = '';
    document.getElementById('fSets').value = 3;
    document.getElementById('fReps').value = '';
    document.getElementById('fRest').value = 60;
    document.getElementById('fTempo').value = '';
    document.getElementById('fTechnique').value = '';
    document.getElementById('exerciseModal').classList.remove('hidden');
    setTimeout(() => document.getElementById('fName').focus(), 100);
}

function openEditModal(id) {
    const db = getDB() || [];
    const ex = db.find(e => e.id === id);
    if (!ex) return;
    editingId = id;
    document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ';
    document.getElementById('fName').value = ex.name || '';
    document.getElementById('fCategory').value = ex.category || '';
    document.getElementById('fMuscles').value = ex.muscles || '';
    document.getElementById('fSets').value = ex.defaultSets || 3;
    document.getElementById('fReps').value = ex.defaultReps || '';
    document.getElementById('fRest').value = ex.defaultRest || 60;
    document.getElementById('fTempo').value = ex.defaultTempo || '';
    document.getElementById('fTechnique').value = ex.technique || '';
    document.getElementById('exerciseModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('exerciseModal').classList.add('hidden');
}

function saveExercise() {
    const name = document.getElementById('fName').value.trim();
    const muscles = document.getElementById('fMuscles').value.trim();

    if (!name) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', true); return; }
    if (!muscles) { showToast('–í–≤–µ–¥–∏—Ç–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü', true); return; }

    const db = getDB() || [];
    const exercise = {
        name,
        category: document.getElementById('fCategory').value.trim(),
        muscles,
        defaultSets: parseInt(document.getElementById('fSets').value) || 3,
        defaultReps: document.getElementById('fReps').value.trim() || '10',
        defaultRest: parseInt(document.getElementById('fRest').value) || 60,
        defaultTempo: document.getElementById('fTempo').value.trim() || '—Å—Ä–µ–¥–Ω–∏–π',
        technique: document.getElementById('fTechnique').value.trim()
    };

    if (editingId !== null) {
        const idx = db.findIndex(e => e.id === editingId);
        if (idx !== -1) { db[idx] = { ...db[idx], ...exercise }; }
        showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
    } else {
        // Check duplicate name
        if (db.find(e => e.name.toLowerCase() === name.toLowerCase())) {
            showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ –µ—Å—Ç—å!', true);
            return;
        }
        const newId = db.length > 0 ? Math.max(...db.map(e => e.id)) + 1 : 1;
        db.push({ id: newId, ...exercise });
        showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
    }

    saveDB(db);
    closeModal();
    renderExercises();
}

function deleteExercise(id) {
    const db = getDB() || [];
    const ex = db.find(e => e.id === id);
    if (!ex) return;
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${ex.name}¬ª –∏–∑ –±–∞–∑—ã?`)) return;
    const filtered = db.filter(e => e.id !== id);
    saveDB(filtered);
    renderExercises();
    showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –±–∞–∑—ã');
}

// ===== Toast =====
function showToast(msg, isError = false) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast' + (isError ? ' error' : '');
    void t.offsetWidth;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== Close modal on overlay click =====
document.getElementById('exerciseModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

// Keyboard: Enter to save, Escape to close
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeModal();
    if (e.key === 'Enter' && e.ctrlKey) saveExercise();
});

initDB();
</script>
</body>
</html>
