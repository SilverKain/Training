<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container { max-width: 900px; margin: 0 auto; }

        header {
            background: white;
            border-radius: 15px;
            padding: 25px 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-left { display: flex; align-items: center; gap: 15px; }

        .back-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }
        .back-btn:hover { transform: scale(1.05); }

        h1 { color: #667eea; font-size: 1.8em; }

        .add-btn {
            background: linear-gradient(135deg, #4caf50 0%, #43a047 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .add-btn:hover { transform: scale(1.05); }

        /* Search & Filter */
        .controls {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 16px;
            border: 2px solid #dbe4ff;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.2s;
        }
        .search-input:focus { border-color: #667eea; }

        .filter-select {
            padding: 10px 16px;
            border: 2px solid #dbe4ff;
            border-radius: 25px;
            font-size: 1em;
            outline: none;
            cursor: pointer;
            background: white;
            color: #333;
        }
        .filter-select:focus { border-color: #667eea; }

        .count-badge {
            background: #667eea;
            color: white;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            white-space: nowrap;
        }

        /* Exercise Cards */
        .exercise-cards { display: flex; flex-direction: column; gap: 12px; }

        .exercise-card {
            background: white;
            border-radius: 12px;
            padding: 18px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .exercise-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            flex-wrap: wrap;
        }

        .card-info { flex: 1; min-width: 0; }

        .card-name {
            font-size: 1.15em;
            font-weight: bold;
            color: #1a1a2e;
            margin-bottom: 4px;
        }

        .card-category {
            display: inline-block;
            background: #eef1ff;
            color: #667eea;
            font-size: 0.8em;
            padding: 2px 10px;
            border-radius: 12px;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .card-muscles {
            color: #667eea;
            font-size: 0.9em;
            font-weight: 500;
        }

        .card-params {
            color: #555;
            font-size: 0.88em;
            margin-top: 4px;
        }

        .card-technique {
            color: #666;
            font-size: 0.88em;
            margin-top: 6px;
            line-height: 1.5;
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }

        .edit-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .edit-btn:hover { transform: scale(1.05); }

        .delete-btn {
            background: linear-gradient(135deg, #ef5350 0%, #e53935 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .delete-btn:hover { transform: scale(1.05); }

        .empty-state {
            background: white;
            border-radius: 12px;
            padding: 50px 30px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            color: #888;
        }
        .empty-state p { font-size: 1.1em; margin-top: 10px; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-overlay.hidden { display: none; }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            font-size: 1.4em;
            color: #667eea;
        }

        .modal-close {
            background: #f44336;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #dbe4ff;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            outline: none;
            transition: border-color 0.2s;
            color: #333;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus { border-color: #667eea; }

        .form-group textarea { min-height: 80px; resize: vertical; }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .save-btn:hover { transform: scale(1.05); }

        .cancel-btn {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        .cancel-btn:hover { background: #ccc; }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4caf50;
            color: white;
            padding: 14px 24px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 9999;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.error { background: #f44336; }

        @media (max-width: 600px) {
            header { padding: 15px; }
            h1 { font-size: 1.3em; }
            .form-row { grid-template-columns: 1fr; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="header-left">
            <a href="index.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥</a>
            <h1>üèãÔ∏è –ë–∞–∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</h1>
        </div>
        <button class="add-btn" onclick="openAddModal()">+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</button>
    </header>

    <div class="controls">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –º—ã—à—Ü–∞–º..." oninput="renderExercises()">
        <select class="filter-select" id="categoryFilter" onchange="renderExercises()">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
        </select>
        <span class="count-badge" id="countBadge">0 —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</span>
    </div>

    <div class="exercise-cards" id="exerciseCards"></div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay hidden" id="exerciseModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h3>
            <button class="modal-close" onclick="closeModal()">‚úï</button>
        </div>

        <div class="form-group">
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" id="fName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <input type="text" id="fCategory" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì—Ä—É–¥—å / –¢—Ä–∏—Ü–µ–ø—Å—ã">
            </div>
            <div class="form-group">
                <label>–ì—Ä—É–ø–ø—ã –º—ã—à—Ü *</label>
                <input type="text" id="fMuscles" placeholder="–ì—Ä—É–¥—å, —Ç—Ä–∏—Ü–µ–ø—Å—ã...">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–ü–æ–¥—Ö–æ–¥–æ–≤ (–ø–æ —É–º–æ–ª—á.)</label>
                <input type="number" id="fSets" min="1" max="20" value="3">
            </div>
            <div class="form-group">
                <label>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π / –≤—Ä–µ–º—è</label>
                <input type="text" id="fReps" placeholder="10-12 –∏–ª–∏ 30 —Å–µ–∫">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>–û—Ç–¥—ã—Ö (—Å–µ–∫)</label>
                <input type="number" id="fRest" min="10" max="300" value="60">
            </div>
            <div class="form-group">
                <label>–¢–µ–º–ø</label>
                <input type="text" id="fTempo" placeholder="—Å—Ä–µ–¥–Ω–∏–π / —Å—Ç–∞—Ç–∏–∫–∞...">
            </div>
        </div>

        <div class="form-group">
            <label>–¢–µ—Ö–Ω–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</label>
            <textarea id="fTechnique" placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–µ—Ö–Ω–∏–∫—É..."></textarea>
        </div>

        <div class="modal-actions">
            <button class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            <button class="save-btn" onclick="saveExercise()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>
</div>

<div class="toast" id="toast"></div>

<script>
const DB_KEY = 'exercisesDB';
const SEED_URL = 'exercises_db.json';
let editingId = null;

// ===== DB Helpers =====
function getDB() {
    const raw = localStorage.getItem(DB_KEY);
    return raw ? JSON.parse(raw) : null;
}

function saveDB(db) {
    localStorage.setItem(DB_KEY, JSON.stringify(db));
}

async function initDB() {
    const existing = getDB();
    if (existing !== null && existing.length > 0) {
        renderExercises();
        return;
    }
    // Try loading from JSON file (works over HTTP)
    try {
        const res = await fetch(SEED_URL);
        if (res.ok) {
            const data = await res.json();
            saveDB(data.exercises || []);
            renderExercises();
            return;
        }
    } catch (e) { /* fallthrough to built-in seed */ }
    // Built-in seed for file:// access
    const seed = [
        { id:1, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç –ø–æ–ª–∞", category:"–ì—Ä—É–¥—å / –¢—Ä–∏—Ü–µ–ø—Å—ã", muscles:"–ì—Ä—É–¥—å, —Ç—Ä–∏—Ü–µ–ø—Å—ã, –ø–µ—Ä–µ–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã", defaultSets:3, defaultReps:"8-10", defaultRest:90, defaultTempo:"2 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–ò–ü: —É–ø–æ—Ä –ª—ë–∂–∞, —Ä—É–∫–∏ —à–∏—Ä–µ –ø–ª–µ—á. –û–ø—É—Å–∫–∞—Ç—å—Å—è –¥–æ –∫–∞—Å–∞–Ω–∏—è –≥—Ä—É–¥–∏ –ø–æ–ª–∞." },
        { id:2, name:"–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"2 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–°—Ç–æ–ø—ã –Ω–∞ —à–∏—Ä–∏–Ω–µ –ø–ª–µ—á, –Ω–æ—Å–∫–∏ —Å–ª–µ–≥–∫–∞ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã." },
        { id:3, name:"–ü–ª–∞–Ω–∫–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ö–æ—Ä, –ø—Ä–µ—Å—Å, —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä—ã –ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫–∞", defaultSets:3, defaultReps:"20-30 —Å–µ–∫", defaultRest:60, defaultTempo:"—Å—Ç–∞—Ç–∏–∫–∞", technique:"–£–ø–æ—Ä –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å—è –∏ –Ω–æ—Å–∫–∏, —Ç–µ–ª–æ –≤ –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏." },
        { id:4, name:"–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç", category:"–Ø–≥–æ–¥–∏—Ü—ã", muscles:"–Ø–≥–æ–¥–∏—Ü—ã, –∑–∞–¥–Ω—è—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"2 –≤–≤–µ—Ä—Ö, 1 –ø–∞—É–∑–∞, 2 –≤–Ω–∏–∑", technique:"–õ—ë–∂–∞ –Ω–∞ —Å–ø–∏–Ω–µ, –Ω–æ–≥–∏ —Å–æ–≥–Ω—É—Ç—ã. –ü–æ–¥–Ω–∏–º–∞—Ç—å —Ç–∞–∑, —Å–∂–∏–º–∞—è —è–≥–æ–¥–∏—Ü—ã." },
        { id:5, name:"–û–±—Ä–∞—Ç–Ω—ã–µ –æ—Ç–∂–∏–º–∞–Ω–∏—è –æ—Ç —Å—Ç—É–ª–∞", category:"–¢—Ä–∏—Ü–µ–ø—Å—ã", muscles:"–¢—Ä–∏—Ü–µ–ø—Å—ã, –∑–∞–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã", defaultSets:3, defaultReps:"8-10", defaultRest:80, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–°–∏–¥—è –Ω–∞ –∫—Ä–∞—é —Å—Ç—É–ª–∞, —Ä—É–∫–∏ –Ω–∞ —Å–∏–¥–µ–Ω–∏–∏." },
        { id:6, name:"–í—ã–ø–∞–¥—ã –Ω–∞ –º–µ—Å—Ç–µ", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –∏–∫—Ä–æ–Ω–æ–∂–Ω—ã–µ", defaultSets:3, defaultReps:"10 –Ω–∞ –Ω–æ–≥—É", defaultRest:60, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–û–¥–Ω–∞ –Ω–æ–≥–∞ –≤–ø–µ—Ä–µ–¥–∏. –û–ø—É—Å–∫–∞—Ç—å—Å—è, —Å–≥–∏–±–∞—è –æ–±–∞ –∫–æ–ª–µ–Ω–∞ –¥–æ 90¬∞." },
        { id:7, name:"–ë–æ–∫–æ–≤–∞—è –ø–ª–∞–Ω–∫–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ö–æ—Å—ã–µ –º—ã—à—Ü—ã –ø—Ä–µ—Å—Å–∞, –∫–æ—Ä", defaultSets:3, defaultReps:"20-30 —Å–µ–∫/—Å—Ç–æ—Ä–æ–Ω—É", defaultRest:60, defaultTempo:"—Å—Ç–∞—Ç–∏–∫–∞", technique:"–õ—ë–∂–∞ –Ω–∞ –±–æ–∫—É, —É–ø–æ—Ä –Ω–∞ –ø—Ä–µ–¥–ø–ª–µ—á—å–µ." },
        { id:8, name:"–°—É–ø–µ—Ä–º–µ–Ω", category:"–°–ø–∏–Ω–∞ / –Ø–≥–æ–¥–∏—Ü—ã", muscles:"–ú—ã—à—Ü—ã —Å–ø–∏–Ω—ã, —è–≥–æ–¥–∏—Ü—ã", defaultSets:3, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–õ—ë–∂–∞ –Ω–∞ –∂–∏–≤–æ—Ç–µ, —Ä—É–∫–∏ –≤–ø–µ—Ä—ë–¥. –ü–æ–¥–Ω–∏–º–∞—Ç—å –≥—Ä—É–¥—å –∏ –Ω–æ–≥–∏." },
        { id:9, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è —É–∑–∫–∏–º —Ö–≤–∞—Ç–æ–º", category:"–¢—Ä–∏—Ü–µ–ø—Å—ã / –ì—Ä—É–¥—å", muscles:"–¢—Ä–∏—Ü–µ–ø—Å—ã, –≥—Ä—É–¥—å (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å)", defaultSets:3, defaultReps:"10-12", defaultRest:90, defaultTempo:"3 —Å–µ–∫ –≤–Ω–∏–∑, 1 –≤–≤–µ—Ä—Ö", technique:"–õ–∞–¥–æ–Ω–∏ —á—É—Ç—å —É–∂–µ –ø–ª–µ—á, –ª–æ–∫—Ç–∏ –±–ª–∏–∂–µ –∫ –∫–æ—Ä–ø—É—Å—É." },
        { id:10, name:"–û—Ç–∂–∏–º–∞–Ω–∏—è —Å —à–∏—Ä–æ–∫–æ–π –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π", category:"–ì—Ä—É–¥—å", muscles:"–ì—Ä—É–¥—å (–≤–Ω–µ—à–Ω—è—è —á–∞—Å—Ç—å), –ø–µ—Ä–µ–¥–Ω–∏–µ –¥–µ–ª—å—Ç—ã, —Ç—Ä–∏—Ü–µ–ø—Å—ã", defaultSets:4, defaultReps:"12-15", defaultRest:60, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–£–ø–æ—Ä –ª—ë–∂–∞, —Ä—É–∫–∏ —à–∏—Ä–æ–∫–æ —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã." },
        { id:11, name:"–Ø–≥–æ–¥–∏—á–Ω—ã–π –º–æ—Å—Ç –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–≥–µ", category:"–Ø–≥–æ–¥–∏—Ü—ã", muscles:"–Ø–≥–æ–¥–∏—Ü—ã, –∑–∞–¥–Ω—è—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"8-10 –Ω–∞ –Ω–æ–≥—É", defaultRest:90, defaultTempo:"–º–µ–¥–ª–µ–Ω–Ω—ã–π", technique:"–û–¥–Ω–∞ —Å—Ç–æ–ø–∞ –Ω–∞ –ø–æ–ª—É, –≤—Ç–æ—Ä–∞—è –Ω–æ–≥–∞ –Ω–∞ –≤–µ—Å—É." },
        { id:12, name:"–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è —Å –ø–∞—É–∑–æ–π", category:"–ù–æ–≥–∏", muscles:"–ö–≤–∞–¥—Ä–∏—Ü–µ–ø—Å—ã, —è–≥–æ–¥–∏—Ü—ã, –±–∏—Ü–µ–ø—Å –±–µ–¥—Ä–∞", defaultSets:4, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å –ø–∞—É–∑–æ–π", technique:"–ó–∞–¥–µ—Ä–∂–∞—Ç—å—Å—è –≤ –Ω–∏–∂–Ω–µ–π —Ç–æ—á–∫–µ 3 —Å–µ–∫." },
        { id:13, name:"–°–∫—Ä—É—á–∏–≤–∞–Ω–∏—è –Ω–∞ –ø—Ä–µ—Å—Å", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ü—Ä—è–º–∞—è –º—ã—à—Ü–∞ –∂–∏–≤–æ—Ç–∞, –ø—Ä–µ—Å—Å", defaultSets:3, defaultReps:"15-20", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–õ—ë–∂–∞ –Ω–∞ —Å–ø–∏–Ω–µ, –ø–æ–¥–Ω–∏–º–∞—Ç—å –ø–ª–µ—á–∏ –æ—Ç –ø–æ–ª–∞." },
        { id:14, name:"–ë–µ—Ä–ø–∏", category:"–ö–∞—Ä–¥–∏–æ / –í—Å—ë —Ç–µ–ª–æ", muscles:"–í—Å—ë —Ç–µ–ª–æ, —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞", defaultSets:3, defaultReps:"10", defaultRest:90, defaultTempo:"–±—ã—Å—Ç—Ä—ã–π", technique:"–ü—Ä—ã–∂–æ–∫ –≤ —É–ø–æ—Ä –ª—ë–∂–∞, –æ—Ç–∂–∏–º–∞–Ω–∏–µ, –ø—Ä—ã–∂–æ–∫ –≤–≤–µ—Ä—Ö." },
        { id:15, name:"–ü–æ–¥—ä—ë–º –Ω–æ–≥ –ª—ë–∂–∞", category:"–ü—Ä–µ—Å—Å / –ö–æ—Ä", muscles:"–ù–∏–∂–Ω–∏–π –ø—Ä–µ—Å—Å, —Å–≥–∏–±–∞—Ç–µ–ª–∏ –±–µ–¥—Ä–∞", defaultSets:3, defaultReps:"12-15", defaultRest:60, defaultTempo:"—Å—Ä–µ–¥–Ω–∏–π", technique:"–ü–æ–¥–Ω–∏–º–∞—Ç—å –ø—Ä—è–º—ã–µ –Ω–æ–≥–∏ –¥–æ 90¬∞, –º–µ–¥–ª–µ–Ω–Ω–æ –æ–ø—É—Å–∫–∞—Ç—å." }
    ];
    saveDB(seed);
    renderExercises();
}

function getCategories(db) {
    const cats = [...new Set(db.map(e => e.category).filter(Boolean))].sort();
    return cats;
}

// ===== Render =====
function renderExercises() {
    const db = getDB() || [];
    const search = document.getElementById('searchInput').value.toLowerCase();
    const cat = document.getElementById('categoryFilter').value;

    // Update category filter options
    const catSelect = document.getElementById('categoryFilter');
    const currentCat = catSelect.value;
    const cats = getCategories(db);
    catSelect.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>' +
        cats.map(c => `<option value="${c}" ${c === currentCat ? 'selected' : ''}>${c}</option>`).join('');

    let filtered = db;
    if (search) {
        filtered = filtered.filter(e =>
            e.name.toLowerCase().includes(search) ||
            (e.muscles || '').toLowerCase().includes(search) ||
            (e.category || '').toLowerCase().includes(search)
        );
    }
    if (cat) {
        filtered = filtered.filter(e => e.category === cat);
    }

    document.getElementById('countBadge').textContent = `${filtered.length} —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π`;

    const container = document.getElementById('exerciseCards');
    if (filtered.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div style="font-size:3em;">üèãÔ∏è</div>
                <p>${search || cat ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫.' : '–ë–∞–∑–∞ –ø—É—Å—Ç–∞. –ù–∞–∂–º–∏—Ç–µ ¬´+ –î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ¬ª.'}</p>
            </div>`;
        return;
    }

    container.innerHTML = filtered.map(ex => `
        <div class="exercise-card">
            <div class="card-top">
                <div class="card-info">
                    <div class="card-name">${escHtml(ex.name)}</div>
                    ${ex.category ? `<span class="card-category">${escHtml(ex.category)}</span>` : ''}
                    <div class="card-muscles">üéØ ${escHtml(ex.muscles || '')}</div>
                    <div class="card-params">
                        ${ex.defaultSets} –ø–æ–¥—Ö. √ó ${escHtml(ex.defaultReps || '')}
                        | –û—Ç–¥—ã—Ö: ${ex.defaultRest}—Å
                        | –¢–µ–º–ø: ${escHtml(ex.defaultTempo || '')}
                    </div>
                    ${ex.technique ? `<div class="card-technique">‚öôÔ∏è ${escHtml(ex.technique)}</div>` : ''}
                </div>
                <div class="card-actions">
                    <button class="edit-btn" onclick="openEditModal(${ex.id})">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                    <button class="delete-btn" onclick="deleteExercise(${ex.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>
    `).join('');
}

function escHtml(str) {
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
}

// ===== Modal =====
function openAddModal() {
    editingId = null;
    document.getElementById('modalTitle').textContent = '–ù–æ–≤–æ–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ';
    document.getElementById('fName').value = '';
    document.getElementById('fCategory').value = '';
    document.getElementById('fMuscles').value = '';
    document.getElementById('fSets').value = 3;
    document.getElementById('fReps').value = '';
    document.getElementById('fRest').value = 60;
    document.getElementById('fTempo').value = '';
    document.getElementById('fTechnique').value = '';
    document.getElementById('exerciseModal').classList.remove('hidden');
    setTimeout(() => document.getElementById('fName').focus(), 100);
}

function openEditModal(id) {
    const db = getDB() || [];
    const ex = db.find(e => e.id === id);
    if (!ex) return;
    editingId = id;
    document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ';
    document.getElementById('fName').value = ex.name || '';
    document.getElementById('fCategory').value = ex.category || '';
    document.getElementById('fMuscles').value = ex.muscles || '';
    document.getElementById('fSets').value = ex.defaultSets || 3;
    document.getElementById('fReps').value = ex.defaultReps || '';
    document.getElementById('fRest').value = ex.defaultRest || 60;
    document.getElementById('fTempo').value = ex.defaultTempo || '';
    document.getElementById('fTechnique').value = ex.technique || '';
    document.getElementById('exerciseModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('exerciseModal').classList.add('hidden');
}

function saveExercise() {
    const name = document.getElementById('fName').value.trim();
    const muscles = document.getElementById('fMuscles').value.trim();

    if (!name) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è', true); return; }
    if (!muscles) { showToast('–í–≤–µ–¥–∏—Ç–µ –≥—Ä—É–ø–ø—ã –º—ã—à—Ü', true); return; }

    const db = getDB() || [];
    const exercise = {
        name,
        category: document.getElementById('fCategory').value.trim(),
        muscles,
        defaultSets: parseInt(document.getElementById('fSets').value) || 3,
        defaultReps: document.getElementById('fReps').value.trim() || '10',
        defaultRest: parseInt(document.getElementById('fRest').value) || 60,
        defaultTempo: document.getElementById('fTempo').value.trim() || '—Å—Ä–µ–¥–Ω–∏–π',
        technique: document.getElementById('fTechnique').value.trim()
    };

    if (editingId !== null) {
        const idx = db.findIndex(e => e.id === editingId);
        if (idx !== -1) { db[idx] = { ...db[idx], ...exercise }; }
        showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ!');
    } else {
        // Check duplicate name
        if (db.find(e => e.name.toLowerCase() === name.toLowerCase())) {
            showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ –µ—Å—Ç—å!', true);
            return;
        }
        const newId = db.length > 0 ? Math.max(...db.map(e => e.id)) + 1 : 1;
        db.push({ id: newId, ...exercise });
        showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
    }

    saveDB(db);
    closeModal();
    renderExercises();
}

function deleteExercise(id) {
    const db = getDB() || [];
    const ex = db.find(e => e.id === id);
    if (!ex) return;
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å ¬´${ex.name}¬ª –∏–∑ –±–∞–∑—ã?`)) return;
    const filtered = db.filter(e => e.id !== id);
    saveDB(filtered);
    renderExercises();
    showToast('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –±–∞–∑—ã');
}

// ===== Toast =====
function showToast(msg, isError = false) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast' + (isError ? ' error' : '');
    void t.offsetWidth;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== Close modal on overlay click =====
document.getElementById('exerciseModal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

// Keyboard: Enter to save, Escape to close
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') closeModal();
    if (e.key === 'Enter' && e.ctrlKey) saveExercise();
});

initDB();
</script>
</body>
</html>
